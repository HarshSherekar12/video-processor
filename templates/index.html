<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Video Manager - Minimal UI</title>
    <link rel="stylesheet" href="/static/styles.css">
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Video Manager</h1>
        <div class="sub"></div>
      </header>

      <div class="grid">
        <div>
          <div class="panel">
            <h3>Create Video</h3>
            <div class="form-row">
              <input id="title" placeholder="Title" />
              <input id="url" placeholder="Video URL or path" />
              <input id="duration" placeholder="Duration (sec)" type="number" />
              <button id="createBtn" class="btn">Create</button>
            </div>
          </div>

          <div class="panel">
            <h3>List</h3>
            <div class="form-row" style="margin-bottom:10px">
              <input id="search" placeholder="search title" />
              <select id="statusFilter">
                <option value="">All</option>
                <option>Draft</option>
                <option>Processing</option>
                <option>Ready</option>
                <option>Failed</option>
              </select>
              <button id="refresh" class="btn ghost small">Refresh</button>
            </div>
            <div id="list" class="video-list"></div>
          </div>
        </div>

        <aside>
          <div class="panel details" id="details">
            <div class="muted">Select a video to view details</div>
          </div>
        </aside>
      </div>

      <footer>Built for NeuralGarage assignment</footer>
    </div>

    <script>
      const api = '/api'
      async function load(){
        const q = document.getElementById('search').value
        const status = document.getElementById('statusFilter').value
        const res = await fetch(`${api}/videos?q=${encodeURIComponent(q)}&status=${encodeURIComponent(status)}`)
        const data = await res.json()
        const list = document.getElementById('list')
        list.innerHTML = ''
        data.forEach(v=>{
          const div = document.createElement('div')
          div.className='video-card'
          div.innerHTML = `<div class="meta"><div class="title">${v.title}</div><div class="status">${v.status} â€¢ ${new Date(v.created_at).toLocaleString()}</div></div><div class="actions"><button class="btn small" data-id="${v.id}">Details</button></div>`
          list.appendChild(div)
        })
        document.querySelectorAll('.video-card .btn').forEach(b=>b.onclick = async e=>{
          const id = e.target.dataset.id
          showDetails(id)
        })
      }

      async function showDetails(id){
        const res = await fetch(`${api}/videos/${id}`)
        const v = await res.json()
        const d = document.getElementById('details')
        d.innerHTML = `<h3>${v.title}</h3>
          <div class="section">Status: <strong>${v.status}</strong></div>
          <div class="section">Duration: ${v.duration}</div>
          <div class="section">Description: ${v.description}</div>
          <h4>Segments</h4>
          <pre>${JSON.stringify(v.segments, null, 2)}</pre>
          <h4>Split</h4>
          <div class="split-box"><textarea id="segmentsInput">[ { "start": 0, "end": 5 }, { "start": 5, "end": 10 } ]</textarea><div style="margin-top:8px"><button id="splitBtn" class="btn">Split</button></div></div>`
        document.getElementById('splitBtn').onclick = async ()=>{
          const payload = { segments: JSON.parse(document.getElementById('segmentsInput').value) }
          const r = await fetch(`${api}/videos/${id}/split`, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload) })
          if(!r.ok){ alert('Error: '+(await r.text())); return }
          alert('Split submitted')
          load();
          showDetails(id)
        }
      }

      document.getElementById('createBtn').onclick = async ()=>{
        const title = document.getElementById('title').value
        const url = document.getElementById('url').value
        const duration = parseFloat(document.getElementById('duration').value || 0)
        const res = await fetch(`${api}/videos`, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({title, description:'', video_url: url, duration}) })
        if(!res.ok){ alert('Create failed'); return }
        document.getElementById('title').value=''
        document.getElementById('url').value=''
        document.getElementById('duration').value=''
        load()
      }

      document.getElementById('refresh').onclick = load
      load()
    </script>
  </body>
</html>
