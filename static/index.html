<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Video Manager - Minimal UI</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 20px }
      .video { border: 1px solid #ddd; padding: 8px; margin: 6px 0 }
      .btn { padding: 6px 10px; cursor: pointer }
    </style>
  </head>
  <body>
    <h1>Videos</h1>

    <div id="create">
      <h3>Create Video</h3>
      <input id="title" placeholder="Title" />
      <input id="url" placeholder="Video URL or path" />
      <input id="duration" placeholder="Duration (sec)" type="number" />
      <button id="createBtn" class="btn">Create</button>
    </div>

    <h3>List</h3>
    <div>
      <input id="search" placeholder="search title" />
      <select id="statusFilter">
        <option value="">All</option>
        <option>Draft</option>
        <option>Processing</option>
        <option>Ready</option>
        <option>Failed</option>
      </select>
      <button id="refresh" class="btn">Refresh</button>
    </div>

    <div id="list"></div>

    <div id="details"></div>

    <script>
      const api = '/api'
      async function load(){
        const q = document.getElementById('search').value
        const status = document.getElementById('statusFilter').value
        const res = await fetch(`${api}/videos?q=${encodeURIComponent(q)}&status=${encodeURIComponent(status)}`)
        const data = await res.json()
        const list = document.getElementById('list')
        list.innerHTML = ''
        data.forEach(v=>{
          const div = document.createElement('div')
          div.className='video'
          div.innerHTML = `<strong>${v.title}</strong> â€” ${v.status} <button class="btn" data-id="${v.id}">Details</button>`
          list.appendChild(div)
        })
        document.querySelectorAll('.video .btn').forEach(b=>b.onclick = async e=>{
          const id = e.target.dataset.id
          showDetails(id)
        })
      }

      async function showDetails(id){
        const res = await fetch(`${api}/videos/${id}`)
        const v = await res.json()
        const d = document.getElementById('details')
        d.innerHTML = `<h3>${v.title}</h3>
          <div>Status: ${v.status}</div>
          <div>Duration: ${v.duration}</div>
          <div>Description: ${v.description}</div>
          <h4>Segments</h4>
          <pre>${JSON.stringify(v.segments, null, 2)}</pre>
          <h4>Split</h4>
          <textarea id="segmentsInput" style="width:100%;height:80px">[ { "start": 0, "end": 5 }, { "start": 5, "end": 10 } ]</textarea>
          <button id="splitBtn" class="btn">Split</button>
        `
        document.getElementById('splitBtn').onclick = async ()=>{
          const payload = { segments: JSON.parse(document.getElementById('segmentsInput').value) }
          const r = await fetch(`${api}/videos/${id}/split`, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload) })
          if(!r.ok){ alert('Error: '+(await r.text())); return }
          alert('Split submitted')
          load();
          showDetails(id)
        }
      }

      document.getElementById('createBtn').onclick = async ()=>{
        const title = document.getElementById('title').value
        const url = document.getElementById('url').value
        const duration = parseFloat(document.getElementById('duration').value || 0)
        const res = await fetch(`${api}/videos`, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({title, description:'', video_url: url, duration}) })
        if(!res.ok){ alert('Create failed'); return }
        document.getElementById('title').value=''
        document.getElementById('url').value=''
        document.getElementById('duration').value=''
        load()
      }

      document.getElementById('refresh').onclick = load
      load()
    </script>
  </body>
</html>
